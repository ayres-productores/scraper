{% extends "base.html" %}

{% block title %}{{ titulo }} - Portal de Seguros{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ titulo }}</h1>
    <a href="{{ url_for('distribucion.clientes') }}" class="btn btn-outline">&#8592; Volver</a>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" class="form-cliente">
            {{ form.hidden_tag() }}

            <div class="form-section">
                <h3>Información Personal</h3>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="nombre">Nombre *</label>
                        {{ form.nombre(class="form-control", placeholder="Nombre") }}
                        {% if form.nombre.errors %}
                        <span class="error-text">{{ form.nombre.errors[0] }}</span>
                        {% endif %}
                    </div>
                    <div class="form-group half">
                        <label for="apellido">Apellido</label>
                        {{ form.apellido(class="form-control", placeholder="Apellido") }}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="telefono_whatsapp">Teléfono WhatsApp *</label>
                        {{ form.telefono_whatsapp(class="form-control", placeholder="+34 612 345 678") }}
                        {% if form.telefono_whatsapp.errors %}
                        <span class="error-text">{{ form.telefono_whatsapp.errors[0] }}</span>
                        {% endif %}
                        <small class="form-text">Formato internacional con código de país</small>
                    </div>
                    <div class="form-group half">
                        <label for="email">Email</label>
                        {{ form.email(class="form-control", placeholder="correo@ejemplo.com") }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="documento_identidad">Documento de Identidad</label>
                    {{ form.documento_identidad(class="form-control", placeholder="DNI/NIE/Pasaporte") }}
                </div>

                <div class="form-group">
                    <label for="notas">Notas</label>
                    {{ form.notas(class="form-control", rows="3", placeholder="Notas internas sobre el cliente...") }}
                </div>
            </div>

            <div class="form-section">
                <h3>Configuración de Mensajes</h3>

                <div class="form-group">
                    <label class="checkbox-label">
                        {{ form.usar_mensaje_estandar(class="checkbox", id="usar_estandar") }}
                        <span>Usar mensaje estándar</span>
                    </label>
                    <small class="form-text">Si está activado, se usará la plantilla predeterminada del sistema</small>
                </div>

                <div class="form-group" id="mensaje-personalizado-container">
                    <label for="mensaje_personalizado">Mensaje Personalizado</label>
                    {{ form.mensaje_personalizado(class="form-control", rows="5", placeholder="Mensaje específico para este cliente...") }}
                    <small class="form-text">
                        Variables disponibles: {nombre}, {apellido}, {compania}, {tipo_seguro}, {numero_poliza}
                    </small>
                </div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('distribucion.clientes') }}" class="btn btn-outline">Cancelar</a>
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-cliente {
    max-width: 700px;
}

.form-section {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--gray-light);
}

.form-section:last-of-type {
    border-bottom: none;
}

.form-section h3 {
    margin-bottom: 1rem;
    color: var(--dark);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding-top: 1rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('usar_estandar');
    const container = document.getElementById('mensaje-personalizado-container');

    function toggleMensaje() {
        container.style.display = checkbox.checked ? 'none' : 'block';
    }

    checkbox.addEventListener('change', toggleMensaje);
    toggleMensaje();
});
</script>
{% endblock %}
